Troy Johnson (Josh Janowicz), the supplier of prescription drugs to fellow high school students in the fictional southern California town of Hillside, commits suicide.
Troy's best friend Dean Stiffle (Jamie Bell), is prescribed more antidepressants by his psychiatrist father Bill (William Fichtner) after discovering the body.
When Dean returns to school, he is antagonized by drug dealers Billy (Justin Chatwin) and Lee (Lou Taylor Pucci), who were supplied by Troy.
Their friend, Crystal Falls (Camilla Belle), flirts with Dean, but he soon realizes that her true intentions are for Dean to retrieve the remaining drugs in Troy's home and refuses to cooperate.
To force Dean to procure the drugs, Billy and Lee plan to kidnap Dean's brother, Charlie (Rory Culkin), as a ransom, but they end up kidnapping another boy named Charlie Bratley (Thomas Curtis) instead.
The kidnappers hold Charlie Bratley  whose parents are unaware that he is missing  overnight at Crystal's home.
Dean eventually agrees to go to Troy's house to find the drugs.
Upon delivery, Billy discovers that the bag doesn't contain the prescription drugs and starts a fight with Dean, leading to Dean's arrest.
While trying to explain everything to Officer Lou Bratley (John Heard), Charlie's father, Dean reveals that his brother Charlie replaced the drugs with a bag of the vitamins that their mother Allie (Allison Janney) sells.
Neither Officer Bratley nor Dean's father believes his story, but he is released, whereupon his father increases his dosage of antidepressants.
Meanwhile, Charlie Stiffle crushes the real drugs and puts them into a casserole that his mother made for Troy's memorial.
The next day is Troy's memorial service and the wedding of Mayor Michael Ebbs (Ralph Fiennes) to Charlie Bratley's mother Terri (Rita Wilson). Lou finally realizes that his son actually has been kidnapped and heads out to look for him.
Now at Lee's house, Crystal asks Lee to help stop the kidnapping scheme, but he does not comply.
Crystal goes to Dean's house for help, where she finds him hallucinating about Troy's death and finally expressing his grief.
Meanwhile, a paranoid Lou, encouraged by Billy, tries to kill Charlie Bratley to avoid being caught, but Charlie fights back and slices the knife through Billy's eye.
Billy runs out into the street, screaming in pain, and is hit by Lou's police car.
Dean attends Troy's memorial, where all of the visitors are intoxicated by the drugs that are in his mother's casserole.
Troy's mother, Carrie (Glenn Close), discloses to Dean that she never knew her son.
Dean tells her about Troy and acknowledges that they were best friends, and she thanks him.
Billy is later sent to prison.
Lee, who successfully changes the narrative of his involvement during the trial, is acquitted.
A closing voice over explains that Dean and Crystal "escape together", and they are shown kissing.